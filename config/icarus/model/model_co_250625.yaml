# ICARUS model configuration
# Revision date: January 15, 2025

__meta__:
  version: "250625"
  date: "2025-06-25"
  description: "ICARUS collection-only model with in-chain calibration, v4 dataset, latest"
  compatible_with:
    base: ">=240719"
    io: ">=240812"
  tags: [collection-only, pre-calibration, ppn-restrict, grappa-use-closest]
  training_set: "v4"

include: model_common.yaml

override:
  # Path to the v4 (mixed lifetime) restricted, collection-only, calibrated model weights
  model.weight_path: /sdf/data/neutrino/icarus/spine/train/mpvmpr_v04/weights/full_chain/calib_r5/snapshot-14999.ckpt

  # Calibration handled before the semantic segmentation stage
  model.modules.chain.calibration: apply
  model.modules.calibration:
    stage: segmentation
    gain:
      gain: 82.03 # e-/ADC
    recombination:
      model: mbox
      efield: 0.4938 # kV/cm
      mip_dedx: 2.105168 # MeV/cm
    lifetime:
      lifetime: 3000 # us
      driftv: 0.157565 # cm/us

  # Charge rescaling uses collection-only charge
  model.modules.chain.charge_rescaling: collection

  # Older PPN/GrapPA loss settings
  model.modules.uresnet_ppn.ppn.classify_endpoints: false
  model.modules.uresnet_ppn_loss.ppn_loss.restrict_to_clusters: true
  model.modules.grappa_shower_loss.node_loss.use_closest: true

  # Interaction grouping restriction applied
  model.modules.grappa_inter.nodes.grouping_through_track: true
