# SBND Full Chain Configuration - July 20th, 2024
# Simulation configuration for SBND - MPV/MPR v01 initial weights
include: sbnd_base.cfg

override:
  # MPV/MPR v01 initial weight path
  model.weight_path: /sdf/data/neutrino/sbnd/spine/train/mpvmpr_v01/weights/full_chain/default/snapshot-1999.ckpt

  # No CRT hits parsed yet
  io.loader.dataset.schema-: crthits
  io.writer.keys-: crthits

  # Uses average charge rescaling
  model.modules.chain.charge_rescaling: average

  # Model adjustments
  model.modules.uresnet_ppn_loss.ppn_loss-: restrict_to_clusters
  model.modules.uresnet_ppn.ppn.classify_endpoints: true
  model.modules.graph_spice.embedder.uresnet.spatial_size: 1728
  model.modules.graph_spice.constructor.graph:
    name: knn
    k: 10
  model.modules.grappa_shower_loss.node_loss-: use_closest
  model.modules.grappa_inter.node_encoder.dedx_max_dist: 5

  # Loss adjustments
  model.modules.grappa_inter.nodes.grouping_through_track: null

  # Post-processor not yet used
  post-:
    - cathode_crosser
    - time_containment
    - start_dedx
    - end_dedx
    - start_straightness
    - particle_spread
    - shower_conversion_distance
    - flash_match

  # Post-processor adjustments
  post.containment-: exclude_pids
  post.containment.min_particle_sizes:
    0: 25
    1: 25

  post.topology_threshold.ke_thresholds:
    4: 50
    default: 25

  post.apply_calibrations.gain.gain: 50.0
  post.apply_calibrations.lifetime.lifetime: 50000

  post.calo_ke.shower_fudge: 1/0.83

  post.direction-: radius

  post.vertex-: update_orientations

  post.mcs_ke-:
    - res_a
    - res_b
    - res_mixture
    - res_weight_ratio
    - res_scale_ratio
