# SBND model configuration
# Revision date: September 1, 2025

__meta__:
  version: "250901"
  date: "2025-09-01"
  description: "SBND model with collection-only charge rescaling"
  compatible_with:
    base: ">=240720"
    io: ">=240720"
  tags:
    [
      collection-only,
      ppn-restrict,
      grappa-use-closest,
      graph-spice-radius,
      grouping-through-track,
    ]
  training_set: "v2"

include: model_common.yaml

override:
  # Path to the v2 restricted model weights
  model.weight_path: !download
    url: https://s3df.slac.stanford.edu/data/neutrino/spine/weights/sbnd/sbnd_co_snapshot_250901.ckpt
    hash: 64d3236d4a6b8ec82532ac74744248bd3cf7874bf872a6663deeee5ae1b87693

  # No pre-calibration
  model.modules.chain.calibration: null

  # Charge rescaling uses collection-only charge
  model.modules.chain.charge_rescaling: collection

  # Older PPN/GrapPA loss settings
  model.modules.uresnet_ppn.ppn.classify_endpoints: false
  model.modules.uresnet_ppn_loss.ppn_loss.restrict_to_clusters: true
  model.modules.grappa_shower_loss.node_loss.use_closest: true

  # Graph-SPICE uses a radius graph with r=1.9 pixels (direct neighbors)
  model.modules.graph_spice.embedder.uresnet.spatial_size: 6144
  model.modules.graph_spice.constructor.graph:
    name: radius
    r: 1.9

  # Interaction grouping dE/dx computation radius set to 10 pixels
  model.modules.grappa_inter.node_encoder.dedx_max_dist: 10

  # Interaction grouping restriction applied
  model.modules.grappa_inter.nodes.grouping_through_track: true
